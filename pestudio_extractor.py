import numpy as np
import glob
import copy
import data_processor
from scipy import stats


def guess_imputation_vector():
    ret = []
    pathes = [
        data_processor.get_train_path("PESTUDIO"),
        data_processor.get_valid_path("PESTUDIO")
    ]

    for i in pathes:
        for fname in glob.glob(i + '*'):
            key = fname[:-5].split('/')[-1]
            # print(key)
            ret.append(copy.deepcopy(data_processor.PestudioParser(fname).process_report()))

    ret = np.array(ret)
    # return np.mean(ret, axis=0)
    return stats.mode(ret)[0].tolist()[0]


def write_imputation_vector(val: list):
    f = open("util_pestudio/imputation.txt", 'w')
    for i in val:
        f.write(str(i) + '\n')
    f.close()


def read_imputation_vector():
    ret = []
    f = open("util_pestudio/imputation.txt", 'r')
    txt = f.readlines()
    for line in txt:
        ret.append(float(line.rstrip()))
    return ret


if __name__ == "__main__":
    res = guess_imputation_vector()
    print(res)
    write_imputation_vector(res)
